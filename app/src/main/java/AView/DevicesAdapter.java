package AView;import android.app.Activity;import android.content.Context;import android.content.Intent;import android.content.res.Resources;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ImageView;import android.widget.TextView;import android.widget.Toast;import androidx.recyclerview.widget.RecyclerView;import com.sonycsl.echo.eoj.device.DeviceObject;import com.sonycsl.echo.eoj.device.housingfacilities.Battery;import com.sonycsl.echo.eoj.device.housingfacilities.ElectricVehicle;import com.sonycsl.echo.eoj.device.housingfacilities.HouseholdSolarPowerGeneration;import java.util.List;import Common.Constants;import Main.EchoController;import Model.MyEchoDevices;import static AView.R.string.current_electric_string;import static AView.R.string.device_disconnected;import static AView.R.string.instantaneous_string;import static AView.R.string.ip_address_string;import static AView.R.string.operation_mode_string;import static AView.R.string.operation_status_string;import static AView.R.string.unknown;import static Model.MyEchoDevices.BATTERY;import static Model.MyEchoDevices.EV;import static Model.MyEchoDevices.SOLAR;import static Model.MyEchoDevices.UNKNOWN;import static android.view.HapticFeedbackConstants.VIRTUAL_KEY;public class DevicesAdapter extends RecyclerView.Adapter<DevicesAdapter.DeviceViewHolder> {      // Store a member variable for the devices      private List<DeviceObject> mDevices;      private Context context;      // Pass in the device array into the constructor      DevicesAdapter() {            mDevices = EchoController.listDevice();      }      // Usually involves inflating a layout from XML and returning the holder      @androidx.annotation.NonNull      @Override      public DeviceViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {            context = parent.getContext();            LayoutInflater inflater = LayoutInflater.from(context);            // Inflate the custom layout            View deviceView = inflater.inflate(R.layout.item_device, parent, false);            // Return a new holder instance            return new DeviceViewHolder(deviceView);      }      // Involves populating data into the item through holder      @Override      public void onBindViewHolder(@androidx.annotation.NonNull DeviceViewHolder deviceViewHolder, int position) {            // Get the data model based on position            DeviceObject deviceObject = mDevices.get(position);            MyEchoDevices device = MyEchoDevices.from(deviceObject);            // Set item views based on your views and data model            // Set name, ipAddress, operation Status            try {                  deviceViewHolder.nameTextView.setText(device.name());                  deviceViewHolder.setIpAddressTxt(deviceObject.getNode().getAddressStr());                  deviceViewHolder.setOperationStatusTxt(device.operationStatus.name());                  // Set Image                  if (device != UNKNOWN)                        deviceViewHolder.deviceImg.setImageResource(device.image());                  // Set Information                  if (device != MyEchoDevices.UNKNOWN) {                        switch (device) {                              case BATTERY:                                    deviceViewHolder.setOperationModeTxt(device.operationMode.japaneseName);                                    deviceViewHolder.setInstantaneousTxt("" + device.d3 + " W");                                    deviceViewHolder.setCurrentTxt("" + device.e2 + " Wh");                                    deviceViewHolder.operationModeTxt.setVisibility(View.VISIBLE);                                    deviceViewHolder.instantaneousTxt.setVisibility(View.VISIBLE);                                    deviceViewHolder.currentTxt.setVisibility(View.VISIBLE);                                    new Thread(() -> {                                          try {                                                synchronized (BATTERY) {                                                      ((Battery) deviceObject).get().reqGetRemainingStoredElectricity1().send(); // E2                                                      BATTERY.wait(Constants.TIME_OUT);                                                }                                                ((Activity) context).runOnUiThread(() -> deviceViewHolder.setCurrentTxt("" + device.e2 + " Wh"));                                          } catch (Exception e) {                                                ((Activity) context).runOnUiThread(() -> deviceViewHolder.setCurrentTxt(Constants.ERROR));                                          }                                    }).start();                                    break;                              case EV:                                    deviceViewHolder.setOperationModeTxt(device.operationMode.japaneseName);                                    deviceViewHolder.setInstantaneousTxt("" + device.d3 + " W");                                    deviceViewHolder.setCurrentTxt("" + device.e2 + " Wh");                                    deviceViewHolder.operationModeTxt.setVisibility(View.VISIBLE);                                    deviceViewHolder.instantaneousTxt.setVisibility(View.VISIBLE);                                    deviceViewHolder.currentTxt.setVisibility(View.VISIBLE);                                    new Thread(() -> {                                          try {                                                synchronized (EV) {                                                      ((ElectricVehicle) deviceObject).get().reqGetRemainingBatteryCapacity1().send(); // E2                                                      EV.wait(Constants.TIME_OUT);                                                }                                                ((Activity) context).runOnUiThread(() -> deviceViewHolder.setCurrentTxt("" + device.e2 + " Wh"));                                          } catch (Exception e) {                                                ((Activity) context).runOnUiThread(() -> deviceViewHolder.setCurrentTxt(Constants.ERROR));                                          }                                    }).start();                                    break;                              case SOLAR:                                    deviceViewHolder.operationModeTxt.setVisibility(View.GONE);                                    deviceViewHolder.setInstantaneousTxt("" + device.e0 + " W");                                    deviceViewHolder.setCurrentTxt("" + device.e1 + " Wh");                                    deviceViewHolder.instantaneousTxt.setVisibility(View.VISIBLE);                                    deviceViewHolder.currentTxt.setVisibility(View.VISIBLE);                                    new Thread(() -> {                                          try {                                                synchronized (SOLAR) {                                                      ((HouseholdSolarPowerGeneration) deviceObject).get().reqGetMeasuredCumulativeAmountOfElectricityGenerated().send(); // E1                                                      SOLAR.wait(Constants.TIME_OUT);                                                }                                                ((Activity) context).runOnUiThread(() -> deviceViewHolder.setCurrentTxt("" + device.e1 + " Wh"));                                          } catch (Exception e) {                                                ((Activity) context).runOnUiThread(() -> deviceViewHolder.setCurrentTxt(Constants.ERROR));                                          }                                    }).start();                                    break;                              case LIGHT:                                    break;                              default:                                    break;                        }                  }                  // Set on click event.                  deviceViewHolder.itemView.setOnClickListener(v -> {                        v.performHapticFeedback(VIRTUAL_KEY);                        try {                              Intent i = new Intent(context, DeviceActivity.class);                              i.putExtra(Constants.PositionKey.value, "" + position);                              i.putExtra(Constants.IpAddressKey.value, deviceObject.getNode().getAddressStr());                              i.putExtra(Constants.EOJKey.value, deviceObject.getEchoClassCode());                              context.startActivity(i);                        } catch (Exception e) {                              System.out.println("Error: " + e.getMessage());                              alertDeviceDisconnected();                        }                  });            } catch (Exception e) {                  /* Device disappeared but data is still loading => null object */                  alertDeviceDisconnected();                  System.out.println("Error: " + e.getMessage());            }      }      private void alertDeviceDisconnected() {            Toast.makeText(context, context.getString(device_disconnected), Toast.LENGTH_SHORT).show();      }      // Returns the total count of items in the list      @Override      public int getItemCount() {            return mDevices.size();      }      // Provide a direct reference to each of the views within a data item      // Used to cache the views within the item layout for fast access      class DeviceViewHolder extends RecyclerView.ViewHolder {            TextView nameTextView;            ImageView deviceImg;            TextView ipAddressTxt, operationStatusTxt, operationModeTxt, currentTxt, instantaneousTxt;            Resources resources;            DeviceViewHolder(View itemView) {                  super(itemView);                  resources = itemView.getResources();                  nameTextView = itemView.findViewById(R.id.name_txt);                  deviceImg = itemView.findViewById(R.id.device_image);                  ipAddressTxt = itemView.findViewById(R.id.ipaddress_txt);                  operationStatusTxt = itemView.findViewById(R.id.operation_status_txt);                  operationModeTxt = itemView.findViewById(R.id.operation_mode_txt);                  currentTxt = itemView.findViewById(R.id.current_txt);                  instantaneousTxt = itemView.findViewById(R.id.instantaneous_txt);            }            void setIpAddressTxt(String ipAddressTxt) {                  String temp = resources.getString(ip_address_string).replace(resources.getString(unknown), "") + ipAddressTxt;                  this.ipAddressTxt.setText(temp);            }            void setOperationStatusTxt(String operationStatusTxt) {                  String temp = resources.getString(operation_status_string).replace(resources.getString(unknown), "") + operationStatusTxt;                  this.operationStatusTxt.setText(temp);            }            void setOperationModeTxt(String operationModeTxt) {                  String temp = resources.getString(operation_mode_string).replace(resources.getString(unknown), "") + operationModeTxt;                  this.operationModeTxt.setText(temp);            }            void setInstantaneousTxt(String instantaneousTxt) {                  String temp = resources.getString(instantaneous_string).replace(resources.getString(unknown), "") + instantaneousTxt;                  this.instantaneousTxt.setText(temp);            }            void setCurrentTxt(String currentTxt) {                  String temp = resources.getString(current_electric_string).replace(resources.getString(unknown), "") + currentTxt;                  this.currentTxt.setText(temp);            }      }}